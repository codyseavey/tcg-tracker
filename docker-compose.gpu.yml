# GPU override for production deployment with NVIDIA GPU
# Usage: IMAGE_TAG=<sha> docker compose -f docker-compose.yml -f docker-compose.gpu.yml up -d
#
# Google Cloud Translation API is auto-configured by CI/CD:
#   - CI/CD symlinks /home/cody/google-cloud-adminSvc.json to secrets/gcloud.json
#   - Backend auto-enables translation if credentials are valid
#   - Falls back to static translation map (1025 Pokemon + trainers) if disabled

services:
  backend:
    environment:
      # Enable translation API if credentials are mounted (empty file = disabled)
      - GOOGLE_APPLICATION_CREDENTIALS=/app/secrets/gcloud.json
    volumes:
      # Mount Google Cloud credentials from server
      - ./secrets:/app/secrets:ro

  identifier:
    environment:
      - USE_GPU=1
      - OCR_LANGUAGES=ja,en  # GPU supports Japanese+English
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
